# สถาปัตยกรรมพื้นฐาน: แกนหลักของ AI Agentic

## ภาพรวม

ส่วนนี้จะกำหนดกระบวนทัศน์พื้นฐานของระบบ โดยเปลี่ยนจากการเป็นแชทบอทธรรมดาไปสู่ระบบ "Agentic" ที่มีความสามารถในการให้เหตุผลและดำเนินการได้ด้วยตนเอง เพื่อสร้างรากฐานที่สามารถขยายขนาดได้สำหรับการเติบโตในอนาคต

## 1.1 การนิยามกระบวนทัศน์ Agentic สำหรับการสนับสนุนเกม

สถาปัตยกรรม Agentic (Agentic Architecture) จะเป็นรากฐานที่สำคัญในการสร้าง AI Agent อัจฉริยะที่สามารถ:

- **รับรู้สภาพแวดล้อม** - ข้อความจากผู้เล่น
- **ตัดสินใจ** - ระบุเจตนาและวางแผนการดำเนินการ  
- **ดำเนินการได้ด้วยตนเอง** - ปฏิบัติงานตามแผนที่วางไว้

แนวทางนี้แตกต่างอย่างสิ้นเชิงจากบอทที่ทำงานตามกฎ (Rule-based) แบบดั้งเดิม ทำให้ระบบสามารถจัดการกับงานที่มีความซับซ้อนและเปลี่ยนแปลงได้ตลอดเวลา เกินกว่าแค่การตอบคำถามที่พบบ่อย (FAQ)

### เป้าหมายของระบบ

ระบบ AI Agent นี้จะได้รับการออกแบบมาเพื่อทำงานภายในสภาพแวดล้อมเสมือนจริงของแพลตฟอร์ม Facebook Messenger โดยมีเป้าหมายเพื่อส่งผลกระทบและปรับปรุงกระบวนการทำงาน (Workflow) ของทั้ง:

- **ทีมบริการลูกค้า (Customer Service - CS)**
- **ทีมบริหารลูกค้าสัมพันธ์ (Customer Relationship Management - CRM)**

แทนที่จะเป็นเพียงเครื่องมือตอบกลับอัตโนมัติ ระบบนี้จะทำหน้าที่เป็น**ผู้ช่วยดิจิทัล**ที่สามารถ:

- รวบรวมข้อมูล
- ดำเนินการตามขั้นตอนที่ซับซ้อน
- เรียนรู้จากการโต้ตอบเพื่อปรับปรุงประสิทธิภาพอย่างต่อเนื่อง

## 1.2 องค์ประกอบหลักของระบบ Agentic

ส่วนนี้จะลงรายละเอียดเกี่ยวกับองค์ประกอบที่สำคัญ 5 ประการของ Agent ซึ่งอ้างอิงจากงานวิจัยด้าน AI ที่เป็นที่ยอมรับ

### 1.2.1 การรับรู้ (Perception)

นี่คือ **"ประสาทสัมผัส"** ของ Agent ซึ่งเกี่ยวข้องกับ:

#### การรับข้อมูล
- รับข้อมูลที่เข้าผ่าน **Facebook Webhooks** สำหรับเหตุการณ์ต่างๆ เช่น:
  - `messages` (ข้อความที่ได้รับ)
  - `message_reads` (การอ่านข้อความ)
  - เหตุการณ์อื่นๆ ที่เกี่ยวข้อง

#### การแยกวิเคราะห์ข้อมูล
- ทำการแยกวิเคราะห์ (Parse) โครงสร้างข้อมูล JSON ที่ได้รับ
- ดึงข้อมูลสำคัญออกมา เช่น:
  - ข้อความของผู้ใช้
  - Page-Scoped ID (PSID) - รหัสเฉพาะของผู้ใช้สำหรับเพจนั้นๆ
  - บริบทของการสนทนาทั้งหมด

กระบวนการนี้เป็นด่านแรกที่สำคัญอย่างยิ่งในการทำความเข้าใจสภาพแวดล้อมและสิ่งที่ผู้ใช้ต้องการสื่อสาร

### 1.2.2 การตัดสินใจ (Decision-Making)

นี่คือ **"สมอง"** หรือแกนกลางในการให้เหตุผลของระบบ ซึ่งขับเคลื่อนโดย **Large Language Model (LLM)**

#### หน้าที่หลัก
LLM จะรับผิดชอบใน:
- **Natural Language Understanding (NLU)** - ความเข้าใจภาษาธรรมชาติ
- **Intent Classification** - การจำแนกเจตนา
- **Entity Extraction** - การสกัดข้อมูลสำคัญ
- **Action Planning** - การวางแผนลำดับการดำเนินการเพื่อบรรลุเป้าหมาย

#### ตัวอย่างการทำงาน
เช่น "แก้ไขปัญหาการดาวน์โหลดเกมของผู้เล่น" - กระบวนการนี้จะมีความซับซ้อนกว่าการจับคู่คำสำคัญ (Keyword Matching) โดย LLM จะพิจารณาบริบททั้งหมดของประโยคเพื่อทำความเข้าใจความต้องการที่แท้จริงของผู้ใช้

### 1.2.3 การกระทำ (Action)

นี่คือ **"มือ"** ของ Agent ที่ใช้ในการปฏิบัติงาน การกระทำต่างๆ จะถูกดำเนินการผ่านการเรียกใช้เครื่องมือ (Tools) ซึ่งเป็นส่วนผสมของ API ทั้งภายในและภายนอก

#### เครื่องมือหลัก

**Facebook_SendAPI_Wrapper**
- ส่งข้อความกลับไปยังผู้ใช้
- ส่ง Quick Replies และ Message Templates

**Internal_GameDB_API**
- สืบค้นข้อมูลจากฐานข้อมูลของเกม
- ตัวอย่าง: "วันเปิดให้บริการเกม" หรือสถานะเซิร์ฟเวอร์

**Internal_Ticketing_API**
- สร้างตั๋วสนับสนุน (Support Ticket) 
- ใช้เมื่อจำเป็นต้องส่งต่อปัญหาให้เจ้าหน้าที่ที่เป็นมนุษย์

**Internal_PlayerAccount_API**
- ดึงข้อมูลที่ไม่ละเอียดอ่อนของผู้เล่น
- นำมาใช้ในการปรับแต่งการตอบสนองให้เป็นส่วนตัว (Personalization)

### 1.2.4 หน่วยความจำ (Memory)

ความสามารถของ Agent ในการจดจำและรักษาบริบทของการสนทนา ระบบจะใช้**สถาปัตยกรรมหน่วยความจำแบบผสม (Hybrid Memory System)**:

#### หน่วยความจำระยะสั้น (Short-Term Memory)
- ใช้บัฟเฟอร์ (เช่น ConversationBufferMemory จากเฟรมเวิร์กอย่าง LangChain)
- รักษาบริบทภายในเซสชันการสนทนาเดียว
- ทำให้ Agent สามารถจดจำสิ่งที่พูดคุยกันไปก่อนหน้าในบทสนทนาปัจจุบันได้

#### หน่วยความจำระยะยาว (Long-Term Memory)
- เชื่อมต่อกับระบบ CRM ของบริษัท
- Agent จะใช้ Conversations API เพื่อดึงประวัติการสนทนาที่ผ่านมาทั้งหมด
- ใช้ PSID เป็นตัวระบุ
- ทำให้สามารถให้บริการที่ต่อเนื่องและตระหนักถึงบริบทในอดีตได้อย่างสมบูรณ์

### 1.2.5 การสื่อสาร (Communication)

ความสามารถของ Agent ในการโต้ตอบกับผู้ใช้และระบบอื่นๆ ซึ่งจะดำเนินการผ่าน **Facebook Send API** เป็นหลัก รวมถึงการเรียกใช้ API ภายในเพื่อประสานงานกับระบบหลังบ้าน

#### รูปแบบการสื่อสาร
การสื่อสารที่มีประสิทธิภาพไม่เพียงแต่หมายถึงการส่งข้อความกลับไป แต่ยังรวมถึง:

- **Quick Replies** - เพื่อแนะนำผู้ใช้
- **Message Templates** - เพื่อนำเสนอข้อมูลที่ซับซ้อนอย่างเป็นระเบียบ
- **API Integration** - เพื่อประสานงานกับระบบภายใน

## 1.3 รูปแบบสถาปัตยกรรม: Single-Agent Orchestrator ที่ขยายขนาดได้

สำหรับการติดตั้งใช้งานในระยะแรก ขอแนะนำให้ใช้**สถาปัตยกรรมแบบ Agent เดี่ยวที่มีประสิทธิภาพสูง (Powerful Single-Agent Architecture)**

### ข้อดีของแนวทางนี้
- ความเรียบง่ายในการออกแบบ
- พัฒนาและแก้ไขข้อบกพร่องง่าย
- เหมาะอย่างยิ่งสำหรับขอบเขตงานเริ่มต้นที่เน้นการจัดการกับคำถามซ้ำๆ ที่มีปริมาณมาก

### การออกแบบแบบ Orchestrator
อย่างไรก็ตาม สถาปัตยกรรมของ Agent เดี่ยวนี้จะถูกออกแบบให้ทำหน้าที่เป็น **ผู้ประสานงาน (Orchestrator)** ซึ่งหมายความว่า:

- ตรรกะหลักจะถูกสร้างขึ้นเพื่อมอบหมายงานให้กับ "ทักษะ" หรือ "เครื่องมือ" ต่างๆ
- ในลักษณะที่เป็นโมดูล (Modular)
- การตัดสินใจเลือกออกแบบเช่นนี้มีความสำคัญอย่างยิ่งต่อความสามารถในการขยายขนาดในอนาคต

### แผนงานในอนาคต (Roadmap)

การออกแบบนี้เป็นการวางรากฐานเพื่อการพัฒนาไปสู่**สถาปัตยกรรมแบบหลาย Agent ในแนวตั้ง (Vertical, Multi-Agent Architecture)** ในระยะที่ 2

#### ในอนาคต Agent ที่ทำหน้าที่เป็น Orchestrator จะสามารถส่งต่อคำถามที่ซับซ้อนไปยัง Agent ย่อยที่เชี่ยวชาญเฉพาะด้านได้ เช่น:
- **BillingAgent** - สำหรับปัญหาการชำระเงิน
- **TechnicalSupportAgent** - สำหรับปัญหาทางเทคนิค
- **BanAppealAgent** - สำหรับคำร้องขอปลดแบน

โดยไม่จำเป็นต้องออกแบบระบบใหม่ทั้งหมด

### ข้อได้เปรียบเชิงกลยุทธ์

การเลือกใช้รูปแบบ **Single-Agent Orchestrator** แทนที่จะเป็น **Monolithic Agent** (Agent ที่ทำงานทุกอย่างในตัวเดียว) เป็นการตัดสินใจเชิงกลยุทธ์ที่มองการณ์ไกล

#### ปัญหาของ Monolithic Agent
แม้ว่า Monolithic Agent อาจสามารถจัดการกับความต้องการเบื้องต้นได้ แต่มันจะสร้าง**หนี้ทางเทคนิค (Technical Debt)** จำนวนมหาศาล ทำให้การขยายระบบในอนาคตเพื่อรองรับงานที่ซับซ้อนและเฉพาะทางมากขึ้น มีค่าใช้จ่ายสูงและทำได้ยาก

#### ข้อได้เปรียบของ Orchestrator
การเริ่มต้นด้วยตรรกะแบบ Orchestrator/Dispatcher เป็นแกนหลักจะช่วยให้บริษัทสามารถ **"เสียบ" (Plug-in)** Agent ผู้เชี่ยวชาญใหม่ๆ เข้ามาในระบบได้ในอนาคต เสมือนเป็นเครื่องมือใหม่ที่ Orchestrator สามารถเรียกใช้ได้

ซึ่งจะช่วยรับประกัน**ความสามารถในการปรับตัวและขยายขนาดของระบบในระยะยาว**

## สรุป

สถาปัตยกรรม AI Agentic นี้ได้รับการออกแบบมาเพื่อ:

1. **ความยืดหยุ่น** - สามารถปรับตัวกับความต้องการที่เปลี่ยนแปลง
2. **ความสามารถในการขยายขนาด** - รองรับการเติบโตในอนาคต
3. **ประสิทธิภาพ** - จัดการกับงานที่ซับซ้อนได้อย่างมีประสิทธิภาพ
4. **การเรียนรู้** - ปรับปรุงตนเองอย่างต่อเนื่อง

ด้วยการใช้แนวทาง Orchestrator แบบโมดูลาร์ ระบบนี้จะเป็นรากฐานที่แข็งแกร่งสำหรับการพัฒนาระบบ AI ที่ทันสมัยและยั่งยืน

---

**หมายเหตุ**: เอกสารนี้เป็นส่วนหนึ่งของชุดเอกสารออกแบบระบบ AI Agentic ที่ครบถ้วน สำหรับรายละเอียดเพิ่มเติม โปดดูเอกสารอื่นๆ ในโฟลเดอร์ `docs/`